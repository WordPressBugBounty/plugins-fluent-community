window.fluentComPortalGeneral={init(){let e=localStorage.getItem("fcom_global_storage");e?this.globalStates=JSON.parse(e):e={},this.initColorSwitch(),document.addEventListener("DOMContentLoaded",()=>{this.initDocReady(),window.fcom_portal_general.scope=="wp"&&this.maybeSetActiveLink()})},initDocReady(){var e=this;if(document.querySelector(".fcom_top_menu")){const n=document.querySelector(".fcom_top_menu").offsetHeight;document.body.style.setProperty("--fcom-header-height",n+"px")}this.initMobileSidebar();const t=document.getElementById("fluent_community_sidebar_menu");t&&(t.addEventListener("click",function(){const n=event.target.closest(".space_section_title");if(!n)return;let l=n.getAttribute("data-group_id"),c=n.closest(".fcom_communities_menu");c&&c.classList.toggle("fcom_group_collapsed");let r=c&&c.classList.contains("fcom_group_collapsed");e.setGroupState("fcom_group_"+l,r?"collapsed":"expanded")}),document.querySelectorAll(".space_section_title").forEach(n=>{let l=n.getAttribute("data-group_id"),c=e.getGroupState("fcom_group_"+l),r=n.closest(".fcom_communities_menu");c==="collapsed"&&r&&r.classList.add("fcom_group_collapsed")}));let o=document.querySelector(".feeds_main");if(o){let n=function(l){let c=l.offsetWidth;document.body.style.setProperty("--fcom-main-content-width",c+"px")};var i=n;n(o),window.addEventListener("resize",function(){n(o)})}this.profileMenuInit(),document.addEventListener("sidebar_menu_reloaded",()=>{this.watchSpaceCreateLink()}),document.dispatchEvent(new CustomEvent("fluentComPortalGeneral",{}))},maybeSetActiveLink(){let e=document.querySelectorAll("li a.fcom_custom_link");e.length&&e.forEach(t=>{let o=t.getAttribute("href");window.location.href.indexOf(o)!==-1&&t.classList.add("router-link-exact-active")})},setCookie(e,t,o=30){let i="";if(o){const n=new Date;n.setTime(n.getTime()+o*24*60*60*1e3),i="; expires="+n.toUTCString()}document.cookie=e+"="+encodeURIComponent(t)+i+"; path=/"},getCookie(e){const t=e+"=",o=document.cookie.split(";");for(let i of o)if(i=i.trim(),i.indexOf(t)===0)return decodeURIComponent(i.substring(t.length));return null},getFromStorage(e,t=""){return this.globalStates&&this.globalStates[e]||t},setToStorage(e,t){this.globalStates||(this.globalStates={}),this.globalStates[e]=t,localStorage.setItem("fcom_global_storage",JSON.stringify(this.globalStates))},getGroupState(e){return this.getFromStorage("groupStates",{})[e]??""},setGroupState(e,t){let o=this.getFromStorage("groupStates",{});o[e]=t,this.setToStorage("groupStates",o)},initMobileSidebar(){let e=document.querySelectorAll(".fcom_space_opener_btn");if(!e.length)return;function t(o){document.querySelector(".space_opened")&&document.querySelector(".space_opened").classList.remove("space_opened"),document.removeEventListener("click",t)}e.forEach(o=>{o.addEventListener("click",function(){document.querySelector(".feed_layout")&&document.querySelector(".feed_layout").classList.toggle("space_opened"),document.querySelector(".feed_layout").classList.contains("space_opened")?setTimeout(()=>{document.addEventListener("click",t)},0):document.removeEventListener("click",t)})})},initColorSwitch(){var o;if(!window.fcom_portal_general||!window.fcom_portal_general.has_color_scheme||document.body.classList.contains("fcom_disable_dark_mode"))return document.querySelectorAll(".fcom_mode_switch").forEach(n=>{n.style.display="none"}),!1;var e=this;document.querySelectorAll(".fcom_mode_switch").forEach(i=>{i.addEventListener("click",function(){var n=document.documentElement.classList.contains("dark")?"light":"dark";e.fcomSetColorMode(n),document.querySelector(".feed_layout")&&document.querySelector(".feed_layout").classList.remove("space_opened")})});let t=e.getFromStorage("fcom_color_mode","");if((o=window.fcom_portal_general)!=null&&o.color_switch_cookie_name){let i=this.getCookie(window.fcom_portal_general.color_switch_cookie_name);(i=="dark"||i=="light")&&(t=i)}t&&this.fcomSetColorMode(t)},fcomSetColorMode(e){var i;if(!["dark","light"].includes(e))return!1;let o="dark";e=="dark"&&(o="light"),document.documentElement.classList.remove(o),e&&(document.documentElement.classList.add(e),document.documentElement.setAttribute("data-color-mode",e),(i=window.fcom_portal_general)!=null&&i.color_switch_cookie_name&&this.setCookie(window.fcom_portal_general.color_switch_cookie_name,e)),this.setToStorage("fcom_color_mode",e)},profileMenuInit(){const e=document.getElementsByClassName("fcom_profile_extend");e.length&&[...e].forEach(t=>{let o=t.querySelector(".fcom_profile_menu"),i=t.querySelector(".fcom_profile_sub_menu");if(!o||!i)return;function n(l){t.classList.remove("fcom_extend_menu"),document.removeEventListener("click",n)}o.addEventListener("click",function(l){t.classList.toggle("fcom_extend_menu"),t.classList.contains("fcom_extend_menu")&&setTimeout(()=>{document.addEventListener("click",n)},0)})})},watchSpaceCreateLink(){let e=document.querySelectorAll(".fcom_space_create_link");e.length&&e.forEach(t=>{t.addEventListener("click",function(o){window.fluentFrameworkApp&&window.fluentFrameworkApp.$eventBus&&(o.stopPropagation(),o.preventDefault(),window.fluentFrameworkApp.$eventBus.emit("createSpaceModal",{parent_id:t.getAttribute("data-parent_id")}))})})}};window.fluentComPortalGeneral.init();
