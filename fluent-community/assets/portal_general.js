window.fluentComPortalGeneral={init(){let e=localStorage.getItem("fcom_global_storage");e?this.globalStates=JSON.parse(e):e={},this.initColorSwitch(),document.addEventListener("DOMContentLoaded",()=>{this.initDocReady(),window.fcom_portal_general.scope=="wp"&&this.maybeSetActiveLink()})},initDocReady(){var e=this;if(document.querySelector(".fcom_top_menu")){const i=document.querySelector(".fcom_top_menu").offsetHeight;document.body.style.setProperty("--fcom-header-height",i+"px");let l=0;const c=document.querySelector(".fcom_mobile_menu");if(c&&(l=c.offsetHeight),document.body.style.setProperty("--fcom-mobile-menu-height",l+"px"),c&&window.visualViewport){var t=window.visualViewport.height;window.visualViewport.addEventListener("resize",function(){var s=window.visualViewport.height<t*.75;document.documentElement.classList.toggle("fcom_keyboard_open",s),document.body.style.setProperty("--fcom-mobile-menu-height",s?"0px":l+"px")})}}this.initMobileSidebar();const o=document.getElementById("fluent_community_sidebar_menu");o&&(o.addEventListener("click",function(){const i=event.target.closest(".space_section_title");if(!i)return;let l=i.getAttribute("data-group_id"),c=i.closest(".fcom_communities_menu");c&&c.classList.toggle("fcom_group_collapsed");let s=c&&c.classList.contains("fcom_group_collapsed");e.setGroupState("fcom_group_"+l,s?"collapsed":"expanded")}),document.querySelectorAll(".space_section_title").forEach(i=>{let l=i.getAttribute("data-group_id"),c=e.getGroupState("fcom_group_"+l),s=i.closest(".fcom_communities_menu");c==="collapsed"&&s&&s.classList.add("fcom_group_collapsed")}));let n=document.querySelector(".feeds_main");if(n){let i=function(l){let c=l.offsetWidth;document.body.style.setProperty("--fcom-main-content-width",c+"px")};var r=i;i(n),window.addEventListener("resize",function(){i(n)})}this.profileMenuInit(),document.addEventListener("sidebar_menu_reloaded",()=>{this.watchSpaceCreateLink()}),document.dispatchEvent(new CustomEvent("fluentComPortalGeneral",{}))},maybeSetActiveLink(){let e=document.querySelectorAll("li a.fcom_custom_link");e.length&&e.forEach(t=>{let o=t.getAttribute("href");window.location.origin+window.location.pathname===o?t.classList.add("router-link-exact-active"):t.classList.remove("router-link-exact-active")})},setCookie(e,t,o=30){let n="";if(o){const r=new Date;r.setTime(r.getTime()+o*24*60*60*1e3),n="; expires="+r.toUTCString()}document.cookie=e+"="+encodeURIComponent(t)+n+"; path=/"},getCookie(e){const t=e+"=",o=document.cookie.split(";");for(let n of o)if(n=n.trim(),n.indexOf(t)===0)return decodeURIComponent(n.substring(t.length));return null},getFromStorage(e,t=""){return this.globalStates&&this.globalStates[e]||t},setToStorage(e,t){this.globalStates||(this.globalStates={}),this.globalStates[e]=t,localStorage.setItem("fcom_global_storage",JSON.stringify(this.globalStates))},getGroupState(e){return this.getFromStorage("groupStates",{})[e]??""},setGroupState(e,t){let o=this.getFromStorage("groupStates",{});o[e]=t,this.setToStorage("groupStates",o)},initMobileSidebar(){let e=document.querySelectorAll(".fcom_space_opener_btn");if(!e.length)return;function t(o){o.target.closest(".fcom_group_title")||o.target.closest(".fcom_space_opener_btn")||(document.querySelector(".space_opened")&&document.querySelector(".space_opened").classList.remove("space_opened"),document.removeEventListener("click",t))}e.forEach(o=>{o.addEventListener("click",function(){document.querySelector(".feed_layout")&&document.querySelector(".feed_layout").classList.toggle("space_opened"),document.querySelector(".feed_layout").classList.contains("space_opened")?setTimeout(()=>{document.addEventListener("click",t)},0):document.removeEventListener("click",t)})})},initColorSwitch(){var o;if(!window.fcom_portal_general||!window.fcom_portal_general.has_color_scheme||document.body.classList.contains("fcom_disable_dark_mode"))return document.querySelectorAll(".fcom_mode_switch").forEach(r=>{r.style.display="none"}),!1;var e=this;document.querySelectorAll(".fcom_mode_switch").forEach(n=>{n.addEventListener("click",function(){var r=document.documentElement.classList.contains("dark")?"light":"dark";e.fcomSetColorMode(r),document.querySelector(".feed_layout")&&document.querySelector(".feed_layout").classList.remove("space_opened")})});let t=e.getFromStorage("fcom_color_mode","");if((o=window.fcom_portal_general)!=null&&o.color_switch_cookie_name){let n=this.getCookie(window.fcom_portal_general.color_switch_cookie_name);(n=="dark"||n=="light")&&(t=n)}t&&this.fcomSetColorMode(t)},fcomSetColorMode(e){var n;if(!["dark","light"].includes(e))return!1;let o="dark";e=="dark"&&(o="light"),document.documentElement.classList.remove(o),e&&(document.documentElement.classList.add(e),document.documentElement.setAttribute("data-color-mode",e),(n=window.fcom_portal_general)!=null&&n.color_switch_cookie_name&&this.setCookie(window.fcom_portal_general.color_switch_cookie_name,e)),this.setToStorage("fcom_color_mode",e)},profileMenuInit(){const e=document.getElementsByClassName("fcom_profile_extend");e.length&&[...e].forEach(t=>{let o=t.querySelector(".fcom_profile_menu"),n=t.querySelector(".fcom_profile_sub_menu");if(!o||!n)return;function r(i){t.classList.remove("fcom_extend_menu"),document.removeEventListener("click",r)}o.addEventListener("click",function(i){t.classList.toggle("fcom_extend_menu"),t.classList.contains("fcom_extend_menu")&&setTimeout(()=>{document.addEventListener("click",r)},0)})})},watchSpaceCreateLink(){let e=document.querySelectorAll(".fcom_space_create_link");e.length&&e.forEach(t=>{t.addEventListener("click",function(o){window.fluentFrameworkApp&&window.fluentFrameworkApp.$eventBus&&(o.stopPropagation(),o.preventDefault(),window.fluentFrameworkApp.$eventBus.emit("createSpaceModal",{parent_id:t.getAttribute("data-parent_id")}))})})}};window.fluentComPortalGeneral.init();
